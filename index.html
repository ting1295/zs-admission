<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中山大学招生咨询平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 原有的所有CSS样式保持不变，只在最后添加以下新样式 */

        /* 添加：自定义聊天控制按钮 */
        .custom-chat-controls {
            position: fixed;
            right: 100px;
            bottom: 30px;
            z-index: 9998;
            display: flex;
            gap: 10px;
        }
        
        .chat-control-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1976d2, #00acc1);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(25, 118, 210, 0.3);
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .chat-control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
        }
        
        .chat-control-btn.close-btn {
            background: linear-gradient(135deg, #f44336, #ff7043);
        }
        
        /* 添加：聊天状态指示器 */
        .chat-status-indicator {
            position: fixed;
            right: 170px;
            bottom: 35px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            color: #1976d2;
            font-weight: 500;
            display: none;
            z-index: 9997;
            border: 1px solid rgba(25, 118, 210, 0.2);
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* 添加：隐藏Coze默认关闭按钮的覆盖层 */
        .coze-custom-close-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: rgba(244, 67, 54, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            z-index: 10002;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            display: none;
        }
        
        /* 添加：使用提示弹窗 */
        .usage-tip {
            position: fixed;
            right: 30px;
            bottom: 100px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            max-width: 300px;
            z-index: 10001;
            border-left: 5px solid #1976d2;
            animation: slideInUp 0.5s ease;
            display: none;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .usage-tip h4 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .usage-tip ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .usage-tip li {
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }
        
        .close-tip-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .custom-chat-controls {
                right: 80px;
                bottom: 20px;
            }
            
            .chat-control-btn {
                width: 42px;
                height: 42px;
                font-size: 16px;
            }
            
            .chat-status-indicator {
                right: 140px;
                bottom: 25px;
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .usage-tip {
                right: 20px;
                bottom: 90px;
                max-width: 280px;
            }
        }
        
        @media (max-width: 480px) {
            .custom-chat-controls {
                right: 70px;
            }
            
            .chat-status-indicator {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- 原有的HTML内容保持不变 -->

    <!-- 添加：聊天状态指示器 -->
    <div class="chat-status-indicator" id="chatStatus">聊天窗口已打开</div>
    
    <!-- 添加：使用提示弹窗 -->
    <div class="usage-tip" id="usageTip">
        <button class="close-tip-btn" id="closeTipBtn">×</button>
        <h4><i class="fas fa-lightbulb"></i> 使用提示</h4>
        <ul>
            <li>点击 <i class="fas fa-comment" style="color:#1976d2;"></i> 按钮打开聊天</li>
            <li>点击 <i class="fas fa-times" style="color:#f44336;"></i> 按钮关闭聊天</li>
            <li>您也可以点击聊天窗口右上角的关闭按钮</li>
            <li>再次点击右下角机器人图标可重新打开</li>
        </ul>
        <div style="font-size:12px; color:#999; text-align:center;">
            关闭提示后将不再显示
        </div>
    </div>
    
    <!-- 原有的Coze SDK容器 -->
    <div id="position_demo"></div>

    <!-- 添加：自定义聊天控制按钮 -->
    <div class="custom-chat-controls">
        <button class="chat-control-btn" id="openChatBtn" title="打开聊天窗口">
            <i class="fas fa-comment"></i>
        </button>
        <button class="chat-control-btn close-btn" id="closeChatBtn" title="关闭聊天窗口">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.15/libs/cn/index.js"></script>
    <script>
        // 初始化Coze SDK
        let cozeClient = null;
        
        // 等待页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 原有的导航和动画代码保持不变
            
            // 初始化Coze SDK
            initCozeSDK();
            
            // 初始化自定义控制功能
            initChatControls();
            
            // 显示使用提示（如果之前没关闭过）
            setTimeout(() => {
                if (!localStorage.getItem('chatTipClosed')) {
                    showUsageTip();
                }
            }, 3000);
        });
        
        function initCozeSDK() {
            cozeClient = new CozeWebSDK.WebChatClient({
                config: {
                    type: 'bot',
                    bot_id: '7602452683702059017',
                    isIframe: false,
                },
                auth: {
                    type: 'token',
                    token: 'cztei_qTMAMoqikmARPa3lXERmB9d1aEyW6NYRTpFlUy2vCrC8CkW8uenJJLtaRIiCO93Q9',
                    onRefreshToken: async () => 'token'
                },
                userInfo: {
                    id: 'user',
                    url: 'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/coze-logo.png',
                    nickname: 'User',
                },
                ui: {
                    base: {
                        icon: 'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/chatsdk-logo.png',
                        layout: 'pc',
                        lang: 'zh-CN', // 改为中文
                        zIndex: 1000
                    },
                    header: {
                        isShow: true,
                        isNeedClose: true,
                    },
                    asstBtn: {
                        isNeed: true
                    },
                    footer: {
                        isShow: true,
                        expressionText: '中山大学招生咨询AI助手',
                    },
                    chatBot: {
                        title: '中山大学招生AI助手', // 改为中文标题
                        uploadable: true,
                        width: 420, // 稍微调大宽度
                    },
                },
                // 添加SDK事件监听
                callbacks: {
                    onChatWindowOpen: function() {
                        console.log('聊天窗口已打开');
                        updateChatStatus('聊天窗口已打开');
                        // 显示自定义关闭按钮
                        document.getElementById('closeChatBtn').style.display = 'flex';
                        // 监听SDK的关闭按钮
                        setTimeout(setupCozeCloseButton, 500);
                    },
                    onChatWindowClose: function() {
                        console.log('聊天窗口已关闭');
                        updateChatStatus('聊天窗口已关闭');
                        // 隐藏自定义关闭按钮
                        document.getElementById('closeChatBtn').style.display = 'none';
                    },
                    onChatWindowShow: function() {
                        console.log('聊天窗口显示');
                    },
                    onChatWindowHide: function() {
                        console.log('聊天窗口隐藏');
                    }
                }
            });
            
            // 初始时隐藏关闭按钮
            document.getElementById('closeChatBtn').style.display = 'none';
        }
        
        function initChatControls() {
            const openBtn = document.getElementById('openChatBtn');
            const closeBtn = document.getElementById('closeChatBtn');
            const closeTipBtn = document.getElementById('closeTipBtn');
            
            // 打开聊天窗口
            openBtn.addEventListener('click', function() {
                if (cozeClient) {
                    cozeClient.open();
                    updateChatStatus('正在打开聊天窗口...');
                    // 显示状态提示
                    showStatus('聊天窗口已打开', 2000);
                }
            });
            
            // 关闭聊天窗口
            closeBtn.addEventListener('click', function() {
                if (cozeClient) {
                    cozeClient.close();
                    updateChatStatus('正在关闭聊天窗口...');
                    // 显示状态提示
                    showStatus('聊天窗口已关闭', 2000);
                }
            });
            
            // 关闭使用提示
            closeTipBtn.addEventListener('click', function() {
                hideUsageTip();
                localStorage.setItem('chatTipClosed', 'true');
            });
            
            // 点击外部关闭提示
            document.addEventListener('click', function(e) {
                const usageTip = document.getElementById('usageTip');
                if (usageTip.style.display === 'block' && 
                    !usageTip.contains(e.target) && 
                    e.target.id !== 'openChatBtn') {
                    hideUsageTip();
                    localStorage.setItem('chatTipClosed', 'true');
                }
            });
        }
        
        // 设置Coze SDK自带的关闭按钮监听
        function setupCozeCloseButton() {
            // 尝试查找Coze SDK的关闭按钮
            const cozeCloseBtn = document.querySelector('.coze-web-sdk-header-close, [class*="close"], button[aria-label*="close"], button[title*="关闭"]');
            if (cozeCloseBtn) {
                cozeCloseBtn.addEventListener('click', function() {
                    setTimeout(() => {
                        document.getElementById('closeChatBtn').style.display = 'none';
                        showStatus('聊天窗口已关闭', 2000);
                    }, 300);
                });
                
                // 添加提示文本
                cozeCloseBtn.setAttribute('title', '点击关闭聊天窗口');
                
                // 添加自定义样式
                const originalHTML = cozeCloseBtn.innerHTML;
                cozeCloseBtn.innerHTML = '× <span style="font-size:12px; margin-left:5px;">关闭</span>';
            }
        }
        
        // 更新聊天状态指示器
        function updateChatStatus(text) {
            const statusEl = document.getElementById('chatStatus');
            statusEl.textContent = text;
            statusEl.style.display = 'block';
            
            // 2秒后自动隐藏
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 2000);
        }
        
        // 显示状态提示（短时显示）
        function showStatus(text, duration = 2000) {
            updateChatStatus(text);
        }
        
        // 显示使用提示
        function showUsageTip() {
            const tipEl = document.getElementById('usageTip');
            tipEl.style.display = 'block';
            
            // 10秒后自动关闭
            setTimeout(() => {
                if (tipEl.style.display === 'block') {
                    hideUsageTip();
                    localStorage.setItem('chatTipClosed', 'true');
                }
            }, 10000);
        }
        
        // 隐藏使用提示
        function hideUsageTip() {
            document.getElementById('usageTip').style.display = 'none';
        }
        
        // 键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl + / 打开/关闭聊天
            if (e.ctrlKey && e.key === '/') {
                e.preventDefault();
                if (document.getElementById('closeChatBtn').style.display === 'none') {
                    document.getElementById('openChatBtn').click();
                } else {
                    document.getElementById('closeChatBtn').click();
                }
            }
            
            // ESC键关闭聊天
            if (e.key === 'Escape') {
                if (document.getElementById('closeChatBtn').style.display !== 'none') {
                    document.getElementById('closeChatBtn').click();
                }
            }
        });
        
        // 添加页面卸载前的清理
        window.addEventListener('beforeunload', function() {
            if (cozeClient) {
                cozeClient.close();
            }
        });
    </script>
    
    <!-- 原有的其他脚本保持不变 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-links a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            const observerOptions = { threshold: 0.1 };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            }, observerOptions);
            document.querySelectorAll('.info-card, .faq-item, .sidebar-card').forEach(el => {
                observer.observe(el);
            });

            console.log('中山大学招生咨询平台已加载完成。');
        });
    </script>
</body>
</html>
